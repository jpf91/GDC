machine:
  services:
    - docker

dependencies:
  cache_directories:
    - "~/docker-shared/sources"
    - "~/docker"
  override:
    - docker info
    - if [[ -e ~/docker/image.tar ]]; then docker load -i ~/docker/image.tar; fi
    - docker pull jpf91/build-gdc:wip
    - mkdir -p ~/docker; docker save jpf91/build-gdc:wip > ~/docker/image.tar
    - mkdir -p $HOME/docker-shared

test:
  override:
    - docker run -v $HOME/docker-shared/:/home/build/shared jpf91/build-gdc:wip /usr/bin/build-gdc build --toolchain=x86_64-linux-gnu/gcc-5/x86_64-linux-gnu --revision=snapshot:f72a00b  --keep-alive=60
    - docker run -v $HOME/docker-shared/:/home/build/shared jpf91/build-gdc:wip /usr/bin/build-gdc build --toolchain=x86_64-linux-gnu/gcc-5/arm-linux-gnueabi --revision=snapshot:f72a00b  --keep-alive=60
    - docker run -v $HOME/docker-shared/:/home/build/shared jpf91/build-gdc:wip /usr/bin/build-gdc build --toolchain=x86_64-linux-gnu/gcc-5/arm-linux-gnueabihf --revision=snapshot:f72a00b  --keep-alive=60
    - docker run -v $HOME/docker-shared/:/home/build/shared jpf91/build-gdc:wip /usr/bin/build-gdc build --toolchain=x86_64-linux-gnu/gcc-5/x86_64-w64-mingw32 --revision=snapshot:f72a00b  --keep-alive=60
    - docker run -v $HOME/docker-shared/:/home/build/shared jpf91/build-gdc:wip /usr/bin/build-gdc build --toolchain=x86_64-linux-gnu/gcc-5/i686-w64-mingw32 --revision=snapshot:f72a00b  --keep-alive=60

deployment:
  nightly:
    branch: travis-docker
    commands:
      - ls -R $HOME/docker-shared
