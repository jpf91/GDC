machine:
  services:
    - docker

dependencies:
  cache_directories:
    - "~/docker-shared/sources"
    - "~/docker"
  override:
    - docker info
    - if [[ -e ~/docker/image.tar ]]; then docker load -i ~/docker/image.tar; fi
    - docker pull jpf91/build-gdc
    - mkdir -p ~/docker; docker save jpf91/build-gdc > ~/docker/image.tar
    - mkdir -p $HOME/docker-shared

test:
  override:
    - ./circle-ci.sh:
        parallel: true

deployment:
  nightly:
    branch: travis-docker
    commands:
      - ls -R $HOME/docker-shared

